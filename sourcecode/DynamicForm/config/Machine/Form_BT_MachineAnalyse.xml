<?xml version="1.0" encoding="utf-8"?>
<Form Id="Form_BT_MachineAnalyse" Name="Form_BT_MachineAnalyse" Desc="设备数据分析" DAImp="DynamicForm.DA.Form_BT_MachineAnalyseDA,DynamicForm">
  <Panel Id="queryPanel" Name="queryPanel" Type="SingleRecord" Additional="{class:'ddz-maindiv',style:'margin-bottom: 20px;'}">
    <Row>
      <Control Name="PKId" Type="hidden" />
      <Control Name="MachineName" Text="设备名称" Width="span8" Type="text" />
      <Control Name="MachineNum" Type="hidden" />
      <Control Name="TimeFrom" Text="时间从" Width="span8" Type="calendar" />
      <Control Name="TimeTo" Text="到" Width="span8" Type="calendar" />
    </Row>
    <Row>
      <Control Name="MachineOEE" Type="hidden" />
    </Row>
    <Row>
      <Control Name="MachineAverageTime" Type="hidden" />
      <Control Name="Remark1" Type="hidden" />
    </Row>
    <Row>
      <Control Name="Remark2" Type="hidden" />
      <Control Name="Remark3" Type="hidden" />
    </Row>
    <Row>
      <Control Name="Remark4" Type="hidden" />
      <Control Name="Remark5" Type="hidden" />
    </Row>
    <Row>
      <Control Name="CreateTime" Type="hidden" />
      <Control Name="CreateUser" Type="hidden" />
    </Row>
    <Row>
      <Control Name="LastModifyTime" Type="hidden" />
      <Control Name="LastModifyUser" Type="hidden" />
    </Row>
    <Row>
      <Control Name="btnQuery" Text="查询" Type="button" ControlAttributes="{class:&quot;ddz-button3&quot;, style:'cursor:pointer'}" Action="query" />
    </Row>
  </Panel>
  <Panel Id="Panel20200910163146127" Name="Panel20200910163146127" Type="SingleRecord">
    <Row>
      <Control Name="Control20200910163322276" Text="Control20200910163322276" Width="span8" Type="custom" />
      <!--DF_CUSTOM_HTML
<style> span{display:inline-block;width:100%;text-align:center;} </style><div><span><div id='container1' style='height:300px;align:center;'></span></div></div>
-->
      <!--DF_SCRIPT
var Position=$('#MachineName').val();

if(Position.length==0){



var myChart = echarts.init(document.getElementById('container1'));
//var myChart1 = echarts.init(document.getElementById('container1'));
initChart();

//initChart1();
function initChart(){

const colorList = ["#9E87FF", '#73DDFF', '#fe9a8b', '#F56948', '#9E87FF']	
var option =  {
    xAxis: {
        type: 'category',
        data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
    },
    yAxis: {
        type: 'value',
        splitLine:{
        	show:false}
    },
    tooltip: {
        trigger: 'axis',
        axisPointer: {
            label: {
                show: true,
                backgroundColor: '#fff',
                color: '#556677',
                borderColor: 'rgba(0,0,0,0)',
                shadowColor: 'rgba(0,0,0,0)',
                shadowOffsetY: 0
            },
            lineStyle: {
                width: 0
            }
        },
        backgroundColor: '#fff',
        textStyle: {
            color: '#5c6c7c'
        },
        padding: [10, 10],
        extraCssText: 'box-shadow: 1px 0 2px 0 rgba(163,163,163,0.5)'
    },


    series: [{
        data: [820, 932, 901, 934, 1290, 1330, 1320],
        type: 'line',
        smooth: true,
        showSymbol: false,
        lineStyle: {
                width: 5,
                color: new echarts.graphic.LinearGradient(1, 1, 0, 0, [{
                        offset: 0,
                        color: '#73DD39'
                    },
                    {
                        offset: 1,
                        color: '#73DDFF'
                    }
                ]),
                shadowColor: 'rgba(115,221,255, 0.3)',
                shadowBlur: 10,
                shadowOffsetY: 20
            },
            itemStyle: {
                normal: {
                    color: colorList[1],
                    borderColor: colorList[1]
                }
            }
        },
      
        {
        data: [820, 932, 901, 934, 1290, 1330, 1320],
        type: 'line',
        smooth: true,
        showSymbol: false,
             lineStyle: {
                width: 5,
                color: new echarts.graphic.LinearGradient(0, 0, 1, 0, [{
                        offset: 0,
                        color: '#fe9a'
                    },
                    {
                        offset: 1,
                        color: '#fe9a8b'
                    }
                ]),
                shadowColor: 'rgba(254,154,139, 0.3)',
                shadowBlur: 10,
                shadowOffsetY: 20
            },
            itemStyle: {
                normal: {
                    color: colorList[4],
                    borderColor: colorList[4]
                }
            }
        },
          {
        data: [820, 932, 901, 934, 1290, 1330, 1320],
        type: 'line',
        smooth: true,
        showSymbol: false,
              lineStyle: {
                width: 5,
                color: new echarts.graphic.LinearGradient(0, 1, 0, 0, [{
                        offset: 0,
                        color: '#9effff'
                    },
                    {
                        offset: 1,
                        color: '#9E87FF'
                    }
                ]),
                shadowColor: 'rgba(254,154,139, 0.3)',
                shadowBlur: 10,
                shadowOffsetY: 20
            },
            itemStyle: {
                normal: {
                    color: colorList[3],
                    borderColor: colorList[3]
                }
            }
        }
        
    ]

};
 myChart.setOption(option);

 initChartOEE();

}




function initChartOEE(){
var labelOption = {
    normal: {
        show: true,
        align: 'left',
        verticalAlign: 'middle',
        formater:function(a,b,c){ return c;},
        fontSize: 16

    }
};

var Position=$('#MachineName').val()
var legend=[Position];
var yName="OEE";
var xName="日期";

$.getJSON('../DataAnalyzeHandler.ashx?action=oeequerycurrent',
      {Position:Position,
      CollectDateFrom:$('#TimeFrom').val(),
      CollectDateTo:$('#TimeTo').val()
             }, function (data) {
                if (data.hasError == true) {
                    alert(data.error);
                    return;
                }
                else {
                   var d1=JSON.parse(data.data1);
                    var d=JSON.parse(data.data);
                    var categories=[];
                    var s=[];
                    //var s = [{ name: '订单计划量', data: [] }, { name: '订单完成量', data: [] }];
                    var lengde=[];
                    for(m in d1){
                      categories[m]=d1[m];
                    }

                   
                    	for(m in d){
						dm=[];
                        for(n in d[m].data_vm){
 							dm.push([d[m].data_vm[n].CTime,d[m].data_vm[n].MachineOEE]);
                        }
                        s.push({name:d[m].name,data:dm,type: 'line',label:labelOption});
                    }
                    for(m in s){
                      lengde[m]=s[m].name;
                    }

                  myChart.setOption({
                      legend: {
                         data:lengde,
                         right:'20'
                       },
					title:[{
						text:'所有设备OEE分析',
						left:'center'
					}],
                      xAxis: {
                       type: 'category',
                       axisTick: {show: false},
                        data: categories,
                        name:xName
                      },
                      yAxis: [{
                        type: 'value',
                        name:yName
                      }],
                    series: 
                       s
                   });





                    
                 
     //                 myChart.setOption({
     //                  legend: {
     //                     data:legend,
     //                     right:'20'
     //                   },
					// title:[{
					// 	text:$('#MachineName').val()+'设备OEE分析',
					// 	left:'center'
					// }],
     //                  xAxis: {
     //                   type: 'category',
     //                   axisTick: {show: false},
     //                    data: categories,
     //                    name:xName
     //                  },
     //                  yAxis: [{
     //                    type: 'value',
     //                    name:yName
     //                  }],
     //                series: 
     //                   s
     //              });



                }

     });
}


}

else{

var myChart = echarts.init(document.getElementById('container1'));
//var myChart1 = echarts.init(document.getElementById('container1'));
initChart();

//initChart1();
function initChart(){

const colorList = ["#9E87FF", '#73DDFF', '#fe9a8b', '#F56948', '#9E87FF']	
var option =  {
    xAxis: {
        type: 'category',
        data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
    },
    yAxis: {
        type: 'value',
        splitLine:{
        	show:false}
    },
    tooltip: {
        trigger: 'axis',
        axisPointer: {
            label: {
                show: true,
                backgroundColor: '#fff',
                color: '#556677',
                borderColor: 'rgba(0,0,0,0)',
                shadowColor: 'rgba(0,0,0,0)',
                shadowOffsetY: 0
            },
            lineStyle: {
                width: 0
            }
        },
        backgroundColor: '#fff',
        textStyle: {
            color: '#5c6c7c'
        },
        padding: [10, 10],
        extraCssText: 'box-shadow: 1px 0 2px 0 rgba(163,163,163,0.5)'
    },

    series: [{
        data: [820, 932, 901, 934, 1290, 1330, 1320],
        type: 'line',
        smooth: true,
        showSymbol: false,
        lineStyle: {
                width: 5,
                color: new echarts.graphic.LinearGradient(1, 1, 0, 0, [{
                        offset: 0,
                        color: '#73DD39'
                    },
                    {
                        offset: 1,
                        color: '#73DDFF'
                    }
                ]),
                shadowColor: 'rgba(115,221,255, 0.3)',
                shadowBlur: 10,
                shadowOffsetY: 20
            },
            itemStyle: {
                normal: {
                    color: colorList[1],
                    borderColor: colorList[1]
                }
            }
        }
        
    ]

};
 myChart.setOption(option);

 initChartOEE();

}




function initChartOEE(){
var labelOption = {
    normal: {
        show: true,
        align: 'left',
        verticalAlign: 'middle',
        formater:function(a,b,c){ return c;},
        fontSize: 16

    }
};

var Position=$('#MachineName').val()
var legend=[Position];
var yName="OEE";
var xName="日期";

$.getJSON('../DataAnalyzeHandler.ashx?action=oeequerycurrent',
      {Position:Position,
      CollectDateFrom:$('#TimeFrom').val(),
      CollectDateTo:$('#TimeTo').val()
             }, function (data) {
                if (data.hasError == true) {
                    alert(data.error);
                    return;
                }
                else {
                   var d1=JSON.parse(data.data1);
                    var d=JSON.parse(data.data);
                    var categories=[];
                    var s=[];
                    //var s = [{ name: '订单计划量', data: [] }, { name: '订单完成量', data: [] }];
                    var lengde=[];
                    for(m in d1){
                      categories[m]=d1[m];
                    }

                    
                  
                    for(m in d){
						dm=[];
                        for(n in d[m].data_vm){
 							dm.push([d[m].data_vm[n].CTime,d[m].data_vm[n].MachineOEE]);
                        }
                        s.push({name:d[m].name,data:dm,type: 'line',label:labelOption});
                      }

                   myChart.setOption({
                      legend: {
                         data:legend,
                         right:'20'
                       },
					title:[{
						text:$('#MachineName').val()+'设备OEE分析',
						left:'center'
					}],
                      xAxis: {
                       type: 'category',
                       axisTick: {show: false},
                        data: categories,
                        name:xName
                      },
                      yAxis: [{
                        type: 'value',
                        name:yName
                      }],
                    series: 
                       s
                  });



                     
     //                 myChart.setOption({
     //                  legend: {
     //                     data:legend,
     //                     right:'20'
     //                   },
					// title:[{
					// 	text:$('#MachineName').val()+'设备OEE分析',
					// 	left:'center'
					// }],
     //                  xAxis: {
     //                   type: 'category',
     //                   axisTick: {show: false},
     //                    data: categories,
     //                    name:xName
     //                  },
     //                  yAxis: [{
     //                    type: 'value',
     //                    name:yName
     //                  }],
     //                series: 
     //                   s
     //              });



                }

     });
}

}
-->
    </Row>
  </Panel>
  <Panel Id="grid1" Name="grid1" Type="MultiRecord" Additional="{&quot;DF_QUERY_CONDITION_PANEL&quot;:&quot;queryPanel&quot;}" Plugins="BUI.Grid.Plugins.CheckSelection,BUI.Grid.Plugins.RowNumber">
    <Column Name="PKId" Visible="false" Sortable="true" />
    <Column Name="MachineName" Text="设备名称" Width="100" Sortable="true" />
    <Column Name="MachineNum" Text="设备编号" Width="100" Sortable="true" />
    <Column Name="MachineOEE" Text="设备OEE" Width="100" Sortable="true" />
    <Column Name="MachineAverageTime" Text="设备平均故障时间" Width="100" Sortable="true" />
    <Column Name="Remark1" Visible="false" Sortable="true" />
    <Column Name="Remark2" Visible="false" Sortable="true" />
    <Column Name="Remark3" Visible="false" Sortable="true" />
    <Column Name="Remark4" Visible="false" Sortable="true" />
    <Column Name="Remark5" Visible="false" Sortable="true" />
    <Column Name="CreateTime" Visible="false" Sortable="true" />
    <Column Name="CreateUser" Visible="false" Sortable="true" />
    <Column Name="LastModifyTime" Visible="false" Sortable="true" />
    <Column Name="LastModifyUser" Visible="false" Sortable="true" />
  </Panel>
  <Panel Id="opPanel" Name="opPanel" Type="SingleRecord">
    <Row>
      <Control Name="btnDelete" Type="hidden" ControlAttributes="{&quot;class&quot;:&quot;ddz-button2&quot;, style:'cursor:pointer', &quot;onclick&quot;:&quot;btnDelete_click();return false;&quot; }" />
      <!--DF_SCRIPT
function btnDelete_click() {
    var grid = BUI.getControl('grid1');
    var selections = grid.getSelection();
    if (selections.length == 0) {
        dfAlert(getRes('请先选择记录'));
        return;
    }
    var p = $.map(selections, function(a) {
        return {
            'PKId': a.PKId
        }
    });
    if (confirm(getRes('确定要删除选定的记录么？'))) {
        dfGetData('deleteform', {
            DF_FORMNAME: 'Form_BT_MachineAnalyse',
            data: BUI.JSON.stringify(p)
        }, function(data) {
            BUI.getControl('grid1').get('store').load();
        });
    }
}
-->
      <Control Name="btnAdd" Type="hidden" ControlAttributes=" {&quot;class&quot;:&quot;ddz-button1&quot;, style:'cursor:pointer',&quot;onclick&quot;:&quot;btnAdd_click();return false;&quot;}" />
      <!--DF_SCRIPT
function btnAdd_click() {
    var url = 'DFIndex.aspx?DF_FORMNAME=Form_BT_MachineAnalyse_Edit';
    var dialog = dfOverlayDialog(800, 600, '', url);
    // 关闭时自动刷新 grid
    dialog.on('closing', function() {
        BUI.getControl('grid1').get('store').load();
    });
}
-->
      <Control Name="btnEdit" Type="hidden" ControlAttributes="{&quot;class&quot;:&quot;ddz-button2&quot;, style:'cursor:pointer', &quot;onclick&quot;:&quot;btnUpdate_click();return false;&quot; }" />
      <!--DF_SCRIPT
function btnUpdate_click() {
    var grid = BUI.getControl('grid1');
    var selections = grid.getSelection();
    if (selections.length != 1) {
        dfAlert(getRes('请选择一条记录进行编辑'));
        return;
    }
    var p = "&EditMode=Edit";
    p += '&PKId=' + selections[0].PKId;
    var url = 'DFIndex.aspx?DF_FORMNAME=Form_BT_MachineAnalyse_Edit' + p;
    var dialog = dfOverlayDialog(800, 600, '', url);
    // 关闭时自动刷新 grid
    dialog.on('closing', function() {
        BUI.getControl('grid1').get('store').load();
    });
}
-->
    </Row>
  </Panel>
</Form>