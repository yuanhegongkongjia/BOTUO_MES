<?xml version="1.0" encoding="utf-8"?>
<Form Id="Form_BT_MachineManage" Name="Form_BT_MachineManage" Desc="设备参数分析" DAImp="DynamicForm.DA.Form_BT_MachineManageDA,DynamicForm">
  <Panel Id="queryPanel" Name="queryPanel" Type="SingleRecord" Additional="{class:'ddz-maindiv',style:'margin-bottom: 20px;'}">
    <Row>
      <Control Name="KPId" Type="hidden" />
      <Control Name="MachineName" Text="设备名称" Width="span8" Type="select" Options="&#x9;&#x9;&#x9;&#x9;select MachineName as text,MachineName  as value from BT_MachineManage &#xA;" OptionType="SQL" />
      <Control Name="MachineNum" Type="hidden" />
      <Control Name="TimeFrom" Text="选择查询日期" Width="span8" Type="calendar" />
      <Control Name="TimeTo" Type="hidden" />
    </Row>
    <Row>
      <Control Name="MachineStatus" Type="hidden" />
    </Row>
    <Row>
      <Control Name="MachineParam" Type="hidden" />
      <Control Name="MachineParam1" Type="hidden" />
      <Control Name="MachineParam2" Type="hidden" />
    </Row>
    <Row>
      <Control Name="MachineParam3" Type="hidden" />
      <Control Name="Remark1" Type="hidden" />
    </Row>
    <Row>
      <Control Name="Remark2" Type="hidden" />
      <Control Name="Remark3" Type="hidden" />
    </Row>
    <Row>
      <Control Name="Remark4" Type="hidden" />
      <Control Name="Remark5" Type="hidden" />
    </Row>
    <Row>
      <Control Name="CreateTime" Type="hidden" />
      <Control Name="CreateUser" Type="hidden" />
    </Row>
    <Row>
      <Control Name="LastModifyTime" Type="hidden" />
      <Control Name="LastModifyUser" Type="hidden" />
    </Row>
    <Row>
      <Control Name="btnQuery" Text="查询" Type="button" ControlAttributes="{class:&quot;ddz-button3&quot;, style:'cursor:pointer'}" Action="query" />
    </Row>
  </Panel>
  <Panel Id="Panel20200908105702225" Name="Panel20200908105702225" Type="SingleRecord">
    <Row>
      <Control Name="Control20200908105725270" Text="Control20200908105725270" Width="span8" Type="custom" />
      <!--DF_CUSTOM_HTML
<style> span{display:inline-block;width:100%;text-align:center;} </style><div><span><div id='container1' style='height:300px;align:center;'></span></div></div>
-->
      <!--DF_SCRIPT
var myChart = echarts.init(document.getElementById('container1'));
initChart();
function initChart(){

var option = {
    //backgroundColor: "#38445E",
    grid: {
		left: '12%',
		top: '10%',
		bottom: '12%',
		right: '15%'
	},

	
    xAxis: {
        data: [],
       axisTick: {
			show: true
		},
		axisLine: {
			lineStyle: {
				color: 'rgba(255, 129, 109, 0.5)',
				width: 1 //这里是为了突出显示加上的
			}
		},
		axisLabel: {
			textStyle: {
				color: '#999',
				fontSize: 12
			}
		}
    },
    yAxis: [{
			splitNumber: 2,
			axisTick: {
				show: true
			},
			axisLine: {
				lineStyle: {
					color: 'rgba(255, 129, 109, 0.5)',
					width: 1 //这里是为了突出显示加上的
				}
			},
			axisLabel: {
				textStyle: {
					//color: '#999'
				}
			},
			splitArea: {
				areaStyle: {
					color: 'rgba(255,255,255,.5)'
				}
			},
			splitLine: {
				show: true,
				lineStyle: {
					color: 'rgba(255, 129, 109, 0.1)',
					width: 0.5,
					type: 'dashed'
				}
			}
		}
	],
    series: [{
        name: 'hill',
        type: 'pictorialBar',
        barCategoryGap: '0%',
        symbol: 'path://M0,10 L10,10 C5.5,10 5.5,5 5,0 C4.5,5 4.5,10 0,10 z',
        label: {
			show: true,
			position: 'top',
			distance: 2,
			color: '#DB5E6A',
			fontWeight: 'bolder',
			fontSize: 12,
		},

        


        itemStyle: {
            normal: {
				color: {
					type: 'linear',
					x: 0,
					y: 0,
					x2: 0,
					y2: 1,
					colorStops: [{
							offset: 0,
							color: 'rgba(232, 94, 106, .8)' //  0%  处的颜色
						},
						{
							offset: 1,
							color: 'rgba(232, 94, 106, .1)' //  100%  处的颜色
						}
					],
					global: false //  缺省为  false
				}
			},
			emphasis: {
				opacity: 1
			}
        },
        data: [],
        z: 10
    }]
};

myChart.setOption(option);
initChartDevice()
}


function initChartDevice(){

var labelOption = {
    // normal: {
    //     show: true,
    //     distance: 12,
    //     align: 'left',
    //     //verticalAlign: 'middle',
    //     rotate: 90,
    //     formatter: function(a,b,c){
    //       return c;
    //      },
    //     fontSize: 12    
    // }
};


var MachineName=$('#MachineName').find("option:selected").text();
//var Line=$('#Line').val();
var legend=[MachineName];
var yName="温度";
var xName="时间";

$.getJSON('../DataAnalyzeHandler.ashx?action=devicequerycurrent',
      { MachineName:$('#MachineName').val(),
       CollectDateFrom:$('#TimeFrom').val()
      //CollectDateTo:$('#TimeTo').val()

        }, function (data) {
                if (data.hasError == true) {
                    alert(data.error);
                    return;
                }
                else {
                     var d1=JSON.parse(data.data1);
                    var d=JSON.parse(data.data);
                    var categories=[];
                    var s=[];
                    var lengend=[];
                for(m in d1){
                  categories[m]=d1[m];
                }
                    for(m in d){
                        dm=[];
                          for(n in d[m].data_vm){
                                                dm.push([d[m].data_vm[n].CTime,d[m].data_vm[n].MachineParam]);
                                             }
  
                          s.push({name:d[m].name,data:dm,type: 'pictorialBar', label: labelOption});
                    }

                 for(m in s){
                  lengend[m]=s[m].name;
                   }

                     myChart.setOption({
                      legend: {
                        data:lengend,
                        right:'60'
                      },
title: [{
        text: $('#MachineName').find("option:selected").text()+'当日设备参数分析',
left:'center'
    }],
                      xAxis: {
                                  type: 'category',
            axisTick: {show: false},
                        data: categories,
                        name:xName
                      },
                          yAxis: [
        {
            type: 'value',
           name:yName
        }
    ],
                    series: s
                  });
          
                }

     });
}
-->
    </Row>
  </Panel>
  <Panel Id="grid1" Name="grid1" Type="MultiRecord" Additional="{&quot;DF_QUERY_CONDITION_PANEL&quot;:&quot;queryPanel&quot;}" Plugins="BUI.Grid.Plugins.CheckSelection,BUI.Grid.Plugins.RowNumber">
    <Column Name="KPId" Visible="false" Sortable="true" />
    <Column Name="MachineName" Text="设备名称" Width="100" Sortable="true" />
    <Column Name="MachineNum" Text="设备编号" Width="100" Sortable="true" />
    <Column Name="MachineStatus" Visible="false" Sortable="true" />
    <Column Name="MachineParam" Text="温度参数" Width="100" Sortable="true" />
    <Column Name="MachineParam1" Visible="false" Sortable="true" />
    <Column Name="MachineParam2" Visible="false" Sortable="true" />
    <Column Name="MachineParam3" Visible="false" Sortable="true" />
    <Column Name="Remark1" Text="时间" Width="150" Sortable="true" />
    <Column Name="Remark2" Visible="false" Sortable="true" />
    <Column Name="Remark3" Visible="false" Sortable="true" />
    <Column Name="Remark4" Visible="false" Sortable="true" />
    <Column Name="Remark5" Visible="false" Sortable="true" />
    <Column Name="CreateTime" Visible="false" Sortable="true" />
    <Column Name="CreateUser" Visible="false" Sortable="true" />
    <Column Name="LastModifyTime" Visible="false" Sortable="true" />
    <Column Name="LastModifyUser" Visible="false" Sortable="true" />
  </Panel>
  <Panel Id="opPanel" Name="opPanel" Type="SingleRecord">
    <Row>
      <Control Name="btnDelete" Type="hidden" ControlAttributes="{&quot;class&quot;:&quot;ddz-button2&quot;, style:'cursor:pointer', &quot;onclick&quot;:&quot;btnDelete_click();return false;&quot; }" />
      <!--DF_SCRIPT
function btnDelete_click() {
    var grid = BUI.getControl('grid1');
    var selections = grid.getSelection();
    if (selections.length == 0) {
        dfAlert(getRes('请先选择记录'));
        return;
    }
    var p = $.map(selections, function(a) {
        return {
            'KPId': a.KPId
        }
    });
    if (confirm(getRes('确定要删除选定的记录么？'))) {
        dfGetData('deleteform', {
            DF_FORMNAME: 'Form_BT_MachineManage',
            data: BUI.JSON.stringify(p)
        }, function(data) {
            BUI.getControl('grid1').get('store').load();
        });
    }
}
-->
      <Control Name="btnAdd" Type="hidden" ControlAttributes=" {&quot;class&quot;:&quot;ddz-button1&quot;, style:'cursor:pointer',&quot;onclick&quot;:&quot;btnAdd_click();return false;&quot;}" />
      <!--DF_SCRIPT
function btnAdd_click() {
    var url = 'DFIndex.aspx?DF_FORMNAME=Form_BT_MachineManage_Edit';
    var dialog = dfOverlayDialog(800, 600, '', url);
    // 关闭时自动刷新 grid
    dialog.on('closing', function() {
        BUI.getControl('grid1').get('store').load();
    });
}
-->
      <Control Name="btnEdit" Type="hidden" ControlAttributes="{&quot;class&quot;:&quot;ddz-button2&quot;, style:'cursor:pointer', &quot;onclick&quot;:&quot;btnUpdate_click();return false;&quot; }" />
      <!--DF_SCRIPT
function btnUpdate_click() {
    var grid = BUI.getControl('grid1');
    var selections = grid.getSelection();
    if (selections.length != 1) {
        dfAlert(getRes('请选择一条记录进行编辑'));
        return;
    }
    var p = "&EditMode=Edit";
    p += '&KPId=' + selections[0].KPId;
    var url = 'DFIndex.aspx?DF_FORMNAME=Form_BT_MachineManage_Edit' + p;
    var dialog = dfOverlayDialog(800, 600, '', url);
    // 关闭时自动刷新 grid
    dialog.on('closing', function() {
        BUI.getControl('grid1').get('store').load();
    });
}
-->
    </Row>
  </Panel>
</Form>